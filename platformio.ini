; PlatformIO Project Configuration File
; Web-Based Desk Height Controller
; ESP32 with VL53L5CX ToF Sensor

[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Build configuration
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    -DASYNCWEBSERVER_REGEX=1

; Serial monitor
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; File system (SPIFFS for web files)
board_build.filesystem = spiffs
board_build.partitions = default.csv

; Library dependencies
lib_deps = 
    sparkfun/SparkFun VL53L5CX Arduino Library@^1.0.3
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git

; Ignore ESP32 built-in WebServer (conflicts with ESPAsyncWebServer)
lib_ignore = WebServer

; Upload configuration
upload_speed = 921600

; Test configuration (Unity framework)
test_framework = unity
test_speed = 115200
; Include src files in test builds (excluding main.cpp via UNIT_TEST flag)
test_build_src = yes

; Static analysis
check_tool = cppcheck
check_flags = 
    cppcheck: --enable=all --std=c++11

; Test-specific build flags
[env:test]
extends = env:esp32dev
build_flags = 
    ${env:esp32dev.build_flags}
    -DUNIT_TEST

; Native test environment with code coverage
[env:native]
platform = native
test_framework = unity
test_build_src = no
lib_deps = 
    ArduinoFake
build_flags = 
    -DUNIT_TEST
    -DNATIVE_TEST
    -std=c++11
    -lgcov
    --coverage
    -O0
    -g
build_unflags = -Os